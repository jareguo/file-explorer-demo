var fs = require('fs');
var path = require('path');
var _ = require('underscore');

var map = {
    'compressed': ['zip', 'rar', 'gz', '7z'],
    'text': ['txt', 'md', 'ini', 'json'],
    'developer': ['meta', 'dll'],
    'image': ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'tga'],
    'pdf': ['pdf'],
    'css': ['css'],
    'html': ['html'],
    'word': ['doc', 'docx'],
    'powerpoint': ['ppt', 'pptx'],
    'movie': ['mkv', 'avi', 'rmvb', 'mp4'],
    'music': ['mp3', 'wav'],
};

var cached = {};
// TODO: 加入驱动器支持
exports.stat = function (filepath) {
    var result = {
        name: path.basename(filepath),
        path: filepath,
    };

    try {
        var stat = fs.statSync(filepath);
        if (stat.isDirectory()) {
            result.type = 'folder';
        }
        else {
            var ext = path.extname(filepath).substr(1);
            result.type = cached[ext];
            if (!result.type) {
                for (var key in map) {
                    if (_.include(map[key], ext)) {
                        cached[ext] = result.type = key;
                        break;
                    }
                }

                if (!result.type)
                    result.type = 'blank';  // unknown type
            }
        }
    }
    catch (e) {
        console.log(e);
        //window.alert(e);
        if (!result.type)
            result.type = 'undefined';
    }

    return result;
}
