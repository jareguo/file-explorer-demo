var events = require('events');
var path = require('path');
var util = require('util');
var mime = require('mime');
if (process.platform == 'win32') {
    var win32 = require("win32");
}

function Tree(jquery_element) {
    events.EventEmitter.call(this);
    this.element = jquery_element;
    jquery_element.jstree();                    // create instance
    this.jstree = jquery_element.jstree(true);  // get the existing instance after create
    var self = this;
    jquery_element.on('select_node.jstree'), function (e, data) {
        if (data.selected) {
            var file_path = data.selected.data('path');
            var type = data.selected.data('type');
            self.emit('navigate', file_path, type);
        }
    }
    //this.jstree.
}
util.inherits(Tree, events.EventEmitter);

Tree.prototype.navigate = function (dir) {
    var pathes = global.getPathData(dir);
    this.jstree.create_node(null, pathes[0].name);
    //var self = this;
    //fs.readdir(dir, function (error, files) {
    //    if (error) {
    //        console.log(error);
    //        window.alert(error);
    //        return;
    //    }

    //    for (var i = 0; i < files.length; ++i) {
    //        files[i] = mime.stat(path.join(dir, files[i]));
    //    }

    //    self.element.html(gen_files_view({ files: files }));
    //});
};

Tree.prototype.selectDrive = function () {
    // focus on my computer

};

exports.Tree = Tree;
